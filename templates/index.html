<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Analysis</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen">

    <div class="bg-white p-6 rounded-lg shadow-lg w-[450px] text-center">
        <h1 class="text-3xl font-bold text-gray-700 mb-4">üîç Sentiment Analysis</h1>

        <textarea id="textInput" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" 
                  placeholder="Nh·∫≠p vƒÉn b·∫£n..."></textarea>

        <button onclick="analyzeSentiment()" 
                class="w-full bg-blue-500 text-white px-4 py-2 mt-3 rounded-lg hover:bg-blue-600 transition">
            Ph√¢n T√≠ch
        </button>

        <!-- Hi·ªÉn th·ªã loading -->
        <div id="loading" class="hidden text-blue-500 mt-3">‚è≥ ƒêang ph√¢n t√≠ch...</div>

        <!-- K·∫øt qu·∫£ -->
        <div id="result" class="mt-4 text-lg font-medium"></div>

        <!-- Progress bar -->
        <div id="progressContainer" class="hidden mt-4 w-full bg-gray-200 rounded-full h-6">
            <div id="progressBar" class="h-6 rounded-full text-white text-center text-sm"></div>
        </div>

        <!-- L·ªãch s·ª≠ -->
        <h2 class="mt-6 text-gray-700 text-lg font-semibold">üìú</h2>
        <div id="history" class="mt-3 text-left text-sm text-gray-600"></div>
    </div>

    <script>
        let historyItems = [];

        function analyzeSentiment() {
            let text = document.getElementById("textInput").value;
            if (!text) {
                alert("H√£y nh·∫≠p vƒÉn b·∫£n!");
                return;
            }

            document.getElementById("loading").classList.remove("hidden");
            document.getElementById("result").innerHTML = "";
            document.getElementById("progressContainer").classList.add("hidden");

            fetch("/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("loading").classList.add("hidden");

                let color = data.sentiment === "positive" ? "bg-green-500" 
                            : data.sentiment === "negative" ? "bg-red-500" 
                            : "bg-gray-500";

                document.getElementById("result").innerHTML = `
                    <p class="text-gray-700">VƒÉn b·∫£n: <strong>${text}</strong></p>
                    <p class="mt-2 ${color} px-2 py-1 text-white inline-block rounded">C·∫£m x√∫c: <strong>${data.sentiment}</strong></p>
                    <p class="text-gray-700 mt-2">ƒê·ªô tin c·∫≠y:</p>
                    <p class="text-green-600">T√≠ch c·ª±c: ${Math.round(data.scores.positive * 100)}%</p>
                    <p class="text-gray-600">Trung l·∫≠p: ${Math.round(data.scores.neutral * 100)}%</p>
                    <p class="text-red-600">Ti√™u c·ª±c: ${Math.round(data.scores.negative * 100)}%</p>
                `;

                let progressBar = document.getElementById("progressBar");
                let progressContainer = document.getElementById("progressContainer");
                progressContainer.classList.remove("hidden");

                let maxScore = Math.max(data.scores.positive, data.scores.neutral, data.scores.negative);
                progressBar.style.width = (maxScore * 100) + "%";
                progressBar.className = `h-6 rounded-full text-white text-center text-sm ${color}`;
                progressBar.innerText = Math.round(maxScore * 100) + "%";

                // C·∫≠p nh·∫≠t l·ªãch s·ª≠
                let history = document.getElementById("history");
                let newHistoryItem = `<p class="border-b py-1"><strong>${text}</strong> ‚ûù 
                    <span class="${color} text-white px-2 py-1 rounded">${data.sentiment}</span></p>`;

                // Th√™m v√†o danh s√°ch l·ªãch s·ª≠ v√† gi·ªõi h·∫°n 5 m·ª•c
                historyItems.unshift(newHistoryItem);
                if (historyItems.length > 5) {
                    historyItems.pop();
                }

                // C·∫≠p nh·∫≠t giao di·ªán l·ªãch s·ª≠
                history.innerHTML = historyItems.join("");
            })
            .catch(error => {
                document.getElementById("loading").classList.add("hidden");
                console.error("L·ªói:", error);
            });
        }
    </script>

</body>
</html>
